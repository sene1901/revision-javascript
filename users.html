<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Liste des utilisateurs Firebase</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

<div class="container mt-5">
  <h2 class="text-center mb-4"> Liste des utilisateurs Firebase</h2>

  <table class="table table-bordered table-striped">
    <thead class="table-dark text-center">
      <tr>
        <th>Nom complet</th>
        <th>Email</th>
        <th>Date d'inscription</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody id="usersTable" class="text-center"></tbody>
  </table>

  <div id="message" class="text-center mt-3"></div>
</div>

<script type="module">
  import { db } from "./firebase-config.js";
  import { collection, onSnapshot, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-firestore.js";

  const usersTable = document.getElementById("usersTable");
  const message = document.getElementById("message");

  // Fonction pour supprimer un utilisateur
  window.deleteUser = async (userId) => {
    if (!confirm("Voulez-vous vraiment supprimer cet utilisateur ?")) return;
    try {
      await deleteDoc(doc(db, "users", userId));
      message.innerHTML = `<div class='alert alert-success'>Utilisateur supprimÃ© âœ…</div>`;
    } catch (error) {
      message.innerHTML = `<div class='alert alert-danger'>Erreur : ${error.message}</div>`;
    }
  };

  // Lecture en temps rÃ©el avec onSnapshot
  onSnapshot(collection(db, "users"), (snapshot) => {
    usersTable.innerHTML = ""; // vider le tableau avant de reconstruire
    if (snapshot.empty) {
      message.innerHTML = `<div class='alert alert-info'>Aucun utilisateur trouvÃ©.</div>`;
      return;
    }
    snapshot.forEach((document) => {
      const user = document.data();
      const userId = document.id;
      const date = user.createdAt?.toDate().toLocaleString("fr-FR") || "Non disponible";

      usersTable.innerHTML += `
        <tr id="row-${userId}">
          <td>${user.name}</td>
          <td>${user.email}</td>
          <td>${date}</td>
          <td>
            <button class="btn btn-danger btn-sm" onclick="deleteUser('${userId}')">ğŸ—‘ï¸ Supprimer</button>
          </td>
        </tr>
      `;
    });
  });
</script>

</body>
</html>
